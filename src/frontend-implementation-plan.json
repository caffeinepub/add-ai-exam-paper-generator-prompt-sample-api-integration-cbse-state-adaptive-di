{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Onboarding: show duplicate-email error and improve profile creation error mapping",
  "requirements": [
    {
      "id": "REQ-30",
      "summary": "Improve onboarding profile-creation error handling to surface duplicate-email errors and avoid incorrect permission messaging.",
      "acceptanceCriteria": [
        "When backend profile creation fails with an error containing \"Email already registered\", the onboarding page displays exactly: \"Email already registered\" in the destructive alert.",
        "When backend profile creation fails for reasons other than authorization/permissions, the onboarding page does not incorrectly display: \"You do not have permission to create this type of profile. Please contact an administrator.\"",
        "Current successful flow remains: after a successful profile creation, the app invalidates/refetches ['currentUserProfile'] and AppShell proceeds to the appropriate dashboard without manual refresh."
      ],
      "file_operations": [
        {
          "path": "frontend/src/features/onboarding/profileCreationErrors.ts",
          "operation": "create",
          "description": "Add a small helper to map backend/profile-creation failures into user-facing onboarding messages, including exact handling for duplicate-email errors (display exactly \"Email already registered\") and more specific permission-message gating. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/features/onboarding/OnboardingProfilePage.tsx",
          "operation": "modify",
          "description": "Use the new profile creation error-mapping helper to set the destructive error alert message. Ensure the UI shows exactly \"Email already registered\" when present, and only shows the generic permission error when the backend failure is truly authorization-related; otherwise prefer a safe generic message or the backend message when user-friendly. Continue using the existing shadcn-ui Alert component for destructive messaging. Verify the component's usage instructions before implementing."
        }
      ]
    }
  ]
}